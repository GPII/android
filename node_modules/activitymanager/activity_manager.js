/*!
GPII Android Activity Manager

Copyright 2012 OCAD University

Licensed under the New BSD license. You may not use this file except in
compliance with this License.

You may obtain a copy of the License at
https://github.com/gpii/universal/LICENSE.txt
*/

// Currently we need to do this in order to work correctly with
// Anode's JS bridge
var thatall = this;

(function () {
    "use strict";

    var fluid = require("universal");
    var gpii = fluid.registerNamespace("gpii");
    var util = require("util");

    var bridge = require("bridge");

    fluid.registerNamespace("gpii.androidActivityManager");

    gpii.androidActivityManager.set = function(settingsarray) {
        var font = bridge.load("net.gpii.AndroidFontSettingsImpl", thatall);
        var newFontSize = settingsarray["com.android.activitymanager"][0]["settings"]["text-scaling-factor"];
        font.setFontSize(newFontSize);
        var app = fluid.copy(settingsarray);
        app["com.android.activitymanager"][0]["settings"]["text-scaling-factor"] = {
            "oldValue": 1.0,
            "newValue": newFontSize
        };
        return app;
    };

    fluid.defaults("gpii.androidActivityManager.startTalkback", {
        gradeNames: "fluid.function",
        argumentMap: {
        }
    });

    fluid.defaults("gpii.androidActivityManager.stopTalkback", {
        gradeNames: "fluid.function",
        argumentMap: {
        }
    });

    fluid.defaults("gpii.androidActivityManager.startFreespeech", {
        gradeNames: "fluid.function",
        argumentMap: {
        }
    });

    fluid.defaults("gpii.androidActivityManager.startActivityByPackageName", {
        gradeNames: "fluid.function",
        argumentMap: {
            packageName: 0
        }
    });

    fluid.defaults("gpii.androidActivityManager.stopActivityByPackageName", {
        gradeNames: "fluid.function",
        argumentMap: {
            packageName: 0
        }
    });

    fluid.defaults("gpii.androidActivityManager.goToHomeScreen", {
        gradeNames: "fluid.function",
        argumentMap: {
        }
    });

    gpii.androidActivityManager.startTalkback = function() {
        var a11y = bridge.load("net.gpii.AndroidA11ySettingsImpl", thatall);
        a11y.startTalkback();
    };

    gpii.androidActivityManager.stopTalkback = function() {
        var a11y = bridge.load("net.gpii.AndroidA11ySettingsImpl", thatall);
        a11y.stopTalkback();
    };

    gpii.androidActivityManager.startFreespeech = function() {
        var intent = bridge.load("net.gpii.AndroidIntentHandlerImpl", thatall);
        intent.startMainLauncherActivity("main","com.blogspot.tonyatkins.freespeech/com.blogspot.tonyatkins.freespeech.activity.StartupActivity");
    };

    gpii.androidActivityManager.startActivityByPackageName = function(packageName) {
        var intent = bridge.load("net.gpii.AndroidIntentHandlerImpl", thatall);
        intent.startActivityByPackageName(packageName);
    };

    gpii.androidActivityManager.stopActivityByPackageName = function(packageName) {
        var intent = bridge.load("net.gpii.AndroidIntentHandlerImpl", thatall);
        intent.stopActivityByPackageName(packageName);
    };

    gpii.androidActivityManager.goToHomeScreen = function() {
        var intent = bridge.load("net.gpii.AndroidIntentHandlerImpl", thatall);
        intent.goToHomeScreen();
    };

})();
